%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% The purspose of this code is to                                     %%%%%%     (1) Read a .mat file containing normalized intensities from a%%%         multi-channel image of a gastruloid and save it as excel%%%                                                                     %%%%%%                                                                     %%%%%% This code is written by                                             %%%%%% Vikas Trivedi, PhD                                                  %%%%%% European Molecular Biology Laboratory (EMBL)                        %%%%%% PRBB, Dr. Aiguader, 88, 08003 Barcelona, Spain                      %%%%%% Phone: +34 (0) 93 628 2708                                          %%%%%% E-Mail: trivedi@embl.es                                             %%%%%% Webpage: embl.org/trivedi                                           %%%%%%                                                                     %%%%%% Please feel free to contact me if you have any questions            %%%%%%                                                                     %%%%%% Copyright (c)2020, Vikas Trivedi                                    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Revision history:%%% 2020/03/19 VT Created the document%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%clcclfclear allclose alldisplay('******************************************')display('Script Gastruloids_LengthAnalysis_XLSfromMatfile.m is running')%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  Script setup (Taking inputs about the folders and files to be read and written)matfilename = '/Users/trivedi/Documents/MATLAB/2018-08-30_RUES2_TR_CorrectedResampledNormalizedProfiles_AllStages.mat';pathnameforoutput = '/Users/trivedi/Documents/MATLAB/Kerim_LengthAnalysis_Output/';filename_coreforoutput = '2018-08-30_RUES2';StageNames = [24,48,72];Chlabels = {'BF','Sox2','Sox17','Bra'};load(matfilename);Stats_dim = size(NormalizedIntensityrange_lengthwise_resampled_all);NDistinctStages = Stats_dim(1,1);NDistinctsamples = Stats_dim(1,2);Mchannels = Stats_dim(1,3);ResamplingVectorLength = Stats_dim(1,4);%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  Creating xls filesfor nstages = 1:NDistinctStages    DeletableIndices = [];        SampleIndices = 1:NDistinctsamples;          filenamexls = strcat(pathnameforoutput, filename_coreforoutput, '_', num2str(StageNames(nstages)),'.xlsx') ;        for nsamples = 1:NDistinctsamples                if (sum(sum(NormalizedIntensityrange_lengthwise_resampled_all(nstages,nsamples,:,:)))==0)            DeletableIndices = [DeletableIndices nsamples];        end            end        if ~isempty(DeletableIndices)        SampleIndices(DeletableIndices) =[]; % Deleting unwanted sample indices    end        TotalNonzeroSamples = length(SampleIndices);    Matrixtowrite = zeros(ResamplingVectorLength,TotalNonzeroSamples*(Mchannels-1));                for nsamples_count = 1:length(SampleIndices)                nsamples = SampleIndices(nsamples_count);                        for m = 2:Mchannels                                NormalizedIntensityrange_lengthwise_m_temp = NormalizedIntensityrange_lengthwise_resampled_all(nstages,nsamples,m,:);                        NormalizedIntensityrange_lengthwise_resampled_m = reshape(NormalizedIntensityrange_lengthwise_m_temp,[1,length(NormalizedIntensityrange_lengthwise_m_temp)]);                        clear NormalizedIntensityrange_lengthwise_m_temp                                    ColumnNumber = (nsamples_count-1)*(Mchannels) + m - 1;            Matrixtowrite(:,ColumnNumber) = NormalizedIntensityrange_lengthwise_resampled_m;                    end            end    writematrix(Matrixtowrite,  filenamexls)clear Matrixtowriteenddisplay('Script Gastruloids_LengthAnalysis_XLSfromMatfile.m is done')display('******************************************')